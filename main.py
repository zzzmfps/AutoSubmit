import os

from ioutil import Utils
from submit import BondChain


def start():
    ''' @return None
    Start a submit execution.
    '''
    # decide paths and convert data to json
    src_text = Utils.input_path('plain-text', 'test/1.txt', True)  # generated by Tencent QQ
    dst_json = Utils.input_path('converted Json', 'test/1.json')
    if os.path.exists(dst_json) and Utils.input_yes_or_no('Json already exists. Skip exec convertion?'):
        print(f'Skipped convertion. Using existing Json [{dst_json}] instead')
    else:
        # create or overwrite
        Utils.convert_txt_to_json(src_text, dst_json)
    # initialize
    bc = BondChain()
    # login
    bc.login()
    # load data from json
    data = Utils.load(dst_json)
    # traverse data and submit them
    failed = bc.add_offers(data)
    # print failed offers
    if failed: print(f'\n* Totally {len(failed)} fail(s):')
    for fail in failed:
        print(fail)
    # end
    input('\nPress any key to continue...')


if __name__ == "__main__":
    start()
